<script type="text/discourse-plugin" version="0.8.18">
    const { showModal } = require("discourse/lib/show-modal");
    const { withPluginApi } = require("discourse/lib/plugin-api");

    const keyholder_group = 67; // discourse group to check to show "book the space" button

    function createSimpleModal() {
        return {
            title: "Book the space",
            html() {
                return `
                    <div class="simple-booking-modal">
                        <p>Simple modal content</p>
                    </div>
                `;
            }
        };
    }

    withPluginApi("0.8.18", api => {
        const user = api.getCurrentUser();
        if (user.groups.some(g => g.id === keyholder_group)) {
            api.createWidget("space-booking-button", {
                tagName: "button.btn.btn-primary",
                html() {
                    return "Host";
                },
                click() {
                    console.log("Host button clicked");
                    showModal("simpleBookingModal", createSimpleModal());
                }
            });

            api.decorateWidget('header-icons:before', (helper) => {
                return [helper.attach("space-booking-button")];
            });
        }
    });
</script>
